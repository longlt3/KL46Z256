/*
 *  TOPPERS/JSP Kernel
 *      Toyohashi Open Platform for Embedded Real-Time Systems/
 *      Just Standard Profile Kernel
 * 
 *  Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
 *                              Toyohashi Univ. of Technology, JAPAN
 * 
 *  ï¿½ï¿½Lï¿½ï¿½ï¿½ìŒ ï¿½Ò‚ÍCï¿½È‰ï¿½ï¿½ï¿½ (1)ï¿½`(4) ï¿½Ìï¿½ï¿½ï¿½ï¿½ï¿½ï¿½CFree Software Foundation 
 *  ï¿½É‚ï¿½ï¿½ï¿½ÄŒï¿½ï¿½\ï¿½ï¿½ï¿½ï¿½Ä‚ï¿½ï¿½ï¿½ GNU General Public License ï¿½ï¿½ Version 2 ï¿½É‹L
 *  ï¿½qï¿½ï¿½ï¿½ï¿½Ä‚ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ð–ž‚ï¿½ï¿½ï¿½ï¿½ê‡ï¿½ÉŒï¿½ï¿½ï¿½Cï¿½{ï¿½\ï¿½tï¿½gï¿½Eï¿½Fï¿½Aï¿½iï¿½{ï¿½\ï¿½tï¿½gï¿½Eï¿½Fï¿½A
 *  ï¿½ï¿½ï¿½ï¿½Ï‚ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ì‚ï¿½ï¿½Ü‚ÞDï¿½È‰ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½jï¿½ï¿½ï¿½gï¿½pï¿½Eï¿½ï¿½ï¿½ï¿½ï¿½Eï¿½ï¿½ÏEï¿½Ä”zï¿½zï¿½iï¿½È‰ï¿½ï¿½C
 *  ï¿½ï¿½ï¿½pï¿½ÆŒÄ‚Ôjï¿½ï¿½ï¿½é‚±ï¿½Æ‚ð–³ï¿½ï¿½Å‹ï¿½ï¿½ï¿½ï¿½D
 *  (1) ï¿½{ï¿½\ï¿½tï¿½gï¿½Eï¿½Fï¿½Aï¿½ï¿½ï¿½\ï¿½[ï¿½Xï¿½Rï¿½[ï¿½hï¿½ÌŒ`ï¿½Å—ï¿½ï¿½pï¿½ï¿½ï¿½ï¿½ê‡ï¿½É‚ÍCï¿½ï¿½Lï¿½Ì’ï¿½ï¿½ï¿½
 *      ï¿½ï¿½ï¿½\ï¿½ï¿½ï¿½Cï¿½ï¿½ï¿½Ì—ï¿½ï¿½pï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ñ‰ï¿½ï¿½Lï¿½Ì–ï¿½ï¿½ÛØ‹Kï¿½è‚ªï¿½Cï¿½ï¿½ï¿½Ì‚Ü‚Ü‚ÌŒ`ï¿½Åƒ\ï¿½[
 *      ï¿½Xï¿½Rï¿½[ï¿½hï¿½ï¿½ï¿½ÉŠÜ‚Ü‚ï¿½Ä‚ï¿½ï¿½é‚±ï¿½ÆD
 *  (2) ï¿½{ï¿½\ï¿½tï¿½gï¿½Eï¿½Fï¿½Aï¿½ï¿½ï¿½Cï¿½ï¿½ï¿½Cï¿½uï¿½ï¿½ï¿½ï¿½ï¿½`ï¿½ï¿½ï¿½È‚ÇCï¿½ï¿½ï¿½Ìƒ\ï¿½tï¿½gï¿½Eï¿½Fï¿½Aï¿½Jï¿½ï¿½ï¿½ÉŽg
 *      ï¿½pï¿½Å‚ï¿½ï¿½ï¿½`ï¿½ÅÄ”zï¿½zï¿½ï¿½ï¿½ï¿½ê‡ï¿½É‚ÍCï¿½Ä”zï¿½zï¿½É”ï¿½ï¿½ï¿½ï¿½hï¿½Lï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½gï¿½iï¿½ï¿½ï¿½p
 *      ï¿½Òƒ}ï¿½jï¿½ï¿½ï¿½Aï¿½ï¿½ï¿½È‚Çjï¿½ÉCï¿½ï¿½Lï¿½Ì’ï¿½ï¿½ìŒ ï¿½\ï¿½ï¿½ï¿½Cï¿½ï¿½ï¿½Ì—ï¿½ï¿½pï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ñ‰ï¿½ï¿½L
 *      ï¿½Ì–ï¿½ï¿½ÛØ‹Kï¿½ï¿½ï¿½ï¿½fï¿½Ú‚ï¿½ï¿½é‚±ï¿½ÆD
 *  (3) ï¿½{ï¿½\ï¿½tï¿½gï¿½Eï¿½Fï¿½Aï¿½ï¿½ï¿½Cï¿½@ï¿½ï¿½É‘gï¿½Ýï¿½ï¿½Þ‚È‚ÇCï¿½ï¿½ï¿½Ìƒ\ï¿½tï¿½gï¿½Eï¿½Fï¿½Aï¿½Jï¿½ï¿½ï¿½ÉŽg
 *      ï¿½pï¿½Å‚ï¿½ï¿½È‚ï¿½ï¿½`ï¿½ÅÄ”zï¿½zï¿½ï¿½ï¿½ï¿½ê‡ï¿½É‚ÍCï¿½ï¿½ï¿½Ì‚ï¿½ï¿½ï¿½ï¿½ê‚©ï¿½Ìï¿½ï¿½ï¿½ï¿½ð–ž‚ï¿½ï¿½ï¿½ï¿½ï¿½
 *      ï¿½ÆD
 *    (a) ï¿½Ä”zï¿½zï¿½É”ï¿½ï¿½ï¿½ï¿½hï¿½Lï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½gï¿½iï¿½ï¿½ï¿½pï¿½Òƒ}ï¿½jï¿½ï¿½ï¿½Aï¿½ï¿½ï¿½È‚Çjï¿½ÉCï¿½ï¿½Lï¿½Ì’ï¿½
 *        ï¿½ìŒ ï¿½\ï¿½ï¿½ï¿½Cï¿½ï¿½ï¿½Ì—ï¿½ï¿½pï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ñ‰ï¿½ï¿½Lï¿½Ì–ï¿½ï¿½ÛØ‹Kï¿½ï¿½ï¿½ï¿½fï¿½Ú‚ï¿½ï¿½é‚±ï¿½ÆD
 *    (b) ï¿½Ä”zï¿½zï¿½ÌŒ`ï¿½Ô‚ï¿½ï¿½Cï¿½Ê‚É’ï¿½ß‚ï¿½ï¿½@ï¿½É‚ï¿½ï¿½ï¿½ÄCTOPPERSï¿½vï¿½ï¿½ï¿½Wï¿½Fï¿½Nï¿½gï¿½ï¿½
 *        ï¿½ñ‚ï¿½ï¿½é‚±ï¿½ÆD
 *  (4) ï¿½{ï¿½\ï¿½tï¿½gï¿½Eï¿½Fï¿½Aï¿½Ì—ï¿½ï¿½pï¿½É‚ï¿½è’¼ï¿½Ú“Iï¿½Ü‚ï¿½ï¿½ÍŠÔÚ“Iï¿½Éï¿½ï¿½ï¿½ï¿½é‚¢ï¿½ï¿½ï¿½È‚é‘¹
 *      ï¿½Qï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Cï¿½ï¿½Lï¿½ï¿½ï¿½ìŒ ï¿½Ò‚ï¿½ï¿½ï¿½ï¿½TOPPERSï¿½vï¿½ï¿½ï¿½Wï¿½Fï¿½Nï¿½gï¿½ï¿½ÆÓ‚ï¿½ï¿½é‚±ï¿½ÆD
 * 
 *  ï¿½{ï¿½\ï¿½tï¿½gï¿½Eï¿½Fï¿½Aï¿½ÍCï¿½ï¿½ï¿½ÛØ‚Å’ñ‹Ÿ‚ï¿½ï¿½ï¿½Ä‚ï¿½ï¿½ï¿½ï¿½ï¿½Ì‚Å‚ï¿½ï¿½ï¿½Dï¿½ï¿½Lï¿½ï¿½ï¿½ìŒ ï¿½Ò‚ï¿½
 *  ï¿½ï¿½ï¿½TOPPERSï¿½vï¿½ï¿½ï¿½Wï¿½Fï¿½Nï¿½gï¿½ÍCï¿½{ï¿½\ï¿½tï¿½gï¿½Eï¿½Fï¿½Aï¿½ÉŠÖ‚ï¿½ï¿½ÄCï¿½ï¿½ï¿½Ì“Kï¿½pï¿½Â”\ï¿½ï¿½ï¿½ï¿½
 *  ï¿½Ü‚ß‚ÄCï¿½ï¿½ï¿½ï¿½ï¿½È‚ï¿½ÛØ‚ï¿½ï¿½sï¿½ï¿½È‚ï¿½ï¿½Dï¿½Ü‚ï¿½ï¿½Cï¿½{ï¿½\ï¿½tï¿½gï¿½Eï¿½Fï¿½Aï¿½Ì—ï¿½ï¿½pï¿½É‚ï¿½è’¼
 *  ï¿½Ú“Iï¿½Ü‚ï¿½ï¿½ÍŠÔÚ“Iï¿½Éï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½È‚é‘¹ï¿½Qï¿½ÉŠÖ‚ï¿½ï¿½Ä‚ï¿½ï¿½Cï¿½ï¿½ï¿½ÌÓ”Cï¿½ð•‰‚ï¿½È‚ï¿½ï¿½D
 * 
 *  @(#) $Id: cpu_context.h,v 1.6 2003/12/01 06:47:05 honda Exp $
 */


/*
 *  ï¿½^ï¿½Xï¿½Nï¿½Rï¿½ï¿½ï¿½eï¿½Lï¿½Xï¿½gï¿½ï¿½ï¿½ìƒ‹ï¿½[ï¿½`ï¿½ï¿½ï¿½iARMv4ï¿½pï¿½j
 *
 *  ï¿½ï¿½ï¿½Ìƒtï¿½@ï¿½Cï¿½ï¿½ï¿½ï¿½ cpu_conf.h ï¿½Æ•ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä‚ï¿½ï¿½ï¿½Ì‚ÍCï¿½ï¿½ï¿½Ìƒtï¿½@ï¿½Cï¿½ï¿½ï¿½ï¿½TCBï¿½ï¿½
 *  ï¿½ï¿½`ï¿½ï¿½ï¿½ê‚½ï¿½ï¿½É“Ç‚Þ•Kï¿½vï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ì‚É‘Î‚ï¿½ï¿½ÄCcpu_conf.h ï¿½É‚ï¿½TCBï¿½ï¿½ï¿½`ï¿½ï¿½
 *  ï¿½ï¿½Oï¿½É“Ç‚Þ•Kï¿½vï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½`ï¿½ï¿½ï¿½Ü‚ï¿½Å‚ï¿½ï¿½é‚½ï¿½ß‚Å‚ï¿½ï¿½ï¿½D
 */

#ifndef _CPU_CONTEXT_H_
#define _CPU_CONTEXT_H_

#include "kernel/task.h"

/*
 *  ï¿½^ï¿½Xï¿½Nï¿½Rï¿½ï¿½ï¿½eï¿½Lï¿½Xï¿½gï¿½uï¿½ï¿½ï¿½bï¿½Nï¿½Ìï¿½ï¿½ï¿½
 *
 *  ï¿½^ï¿½Xï¿½Nï¿½ï¿½ï¿½xï¿½~ï¿½ï¿½Ô‚ÉˆÚsï¿½ï¿½ï¿½éŽžï¿½iï¿½^ï¿½Xï¿½Nï¿½Ìï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Cï¿½^ï¿½Xï¿½Nï¿½ÌIï¿½ï¿½ï¿½ï¿½ï¿½jï¿½ÉŒï¿½
 *  ï¿½Î‚ï¿½ï¿½Dï¿½ï¿½{ï¿½Iï¿½É‚ÍCï¿½^ï¿½Xï¿½Nï¿½Rï¿½ï¿½ï¿½eï¿½Lï¿½Xï¿½gï¿½uï¿½ï¿½ï¿½bï¿½Nï¿½ï¿½ï¿½^ï¿½Xï¿½Nï¿½ï¿½ï¿½Nï¿½ï¿½ï¿½Å‚ï¿½ï¿½ï¿½
 *  ï¿½ï¿½Ô‚ÉÝ’è‚·ï¿½éˆï¿½ï¿½ï¿½ï¿½ï¿½Ccreate_context ï¿½ï¿½ activate_context ï¿½Åsï¿½ï¿½ï¿½ï¿½
 *  ï¿½æ‚¢ï¿½Dï¿½ï¿½ï¿½ï¿½ï¿½Ìï¿½ï¿½ï¿½ï¿½Í‚Ç‚ï¿½ï¿½ï¿½ÌŠÖï¿½ï¿½Åsï¿½ï¿½ï¿½Ä‚ï¿½ï¿½æ‚¢ï¿½D
 */
Inline void
create_context(TCB *tcb)
{
}

/*
 *  ï¿½^ï¿½Xï¿½Nï¿½Ì‹Nï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
 *
 *  ï¿½^ï¿½Xï¿½Nï¿½ï¿½ï¿½xï¿½~ï¿½ï¿½Ô‚ï¿½ï¿½ï¿½ï¿½ï¿½sï¿½Å‚ï¿½ï¿½ï¿½ï¿½Ô‚ÉˆÚsï¿½ï¿½ï¿½éŽžï¿½ÉŒÄ‚Î‚ï¿½ï¿½D
 *  
 */
extern void	activate_r(void);

Inline void
activate_context(TCB *tcb)
{
	VW	*sp;

    sp = (VW *)(((SIZE) tcb->tinib->stk) + tcb->tinib->stksz);
	*--sp = (VW)(tcb->tinib->task);    
	*--sp = (VW)(tcb->tinib->exinf);
	tcb->tskctxb.sp = sp;
	tcb->tskctxb.pc = activate_r;
}


/*
 *  ext_tsk ï¿½ï¿½ï¿½Xï¿½^ï¿½bï¿½Nï¿½ï¿½ÉŠmï¿½Û‚ï¿½ï¿½ï¿½_ï¿½~ï¿½[ï¿½Ìˆï¿½ÌƒTï¿½Cï¿½Y
 *  
 */
#define	ACTIVATED_STACK_SIZE	(sizeof(VW) * 2)

/*
 *  calltex ï¿½ÍŽgï¿½pï¿½ï¿½ï¿½È‚ï¿½
 */
#define OMIT_CALLTEX

#endif /* _CPU_CONTEXT_H_ */







